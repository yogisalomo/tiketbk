/*******************************************************************************

    Title :  
    Date  :  September 2014
    Author:  Suitmedia (http://www.suitmedia.com)

********************************************************************************/

var Site = {

    assets: {
        _jquery_cdn     : '//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js',
        _jquery_local   : myPrefix + '/js/vendor/jquery.min.js',
        _fastclick      : myPrefix + '/js/vendor/fastclick.min.js',
        _bx_Slider      : myPrefix + '/js/vendor/jquery.bxslider.min.js',
        _easyZoom       : myPrefix + '/js/vendor/easyzoom.min.js',
        _chosen         : myPrefix + '/js/vendor/chosen.min.js',
        _datepicker     : [myPrefix + '/js/vendor/jquery.datetimepicker.min.js', myPrefix + '/css/jquery.datetimepicker.css'],
        _fancyBox       : [myPrefix + '/js/vendor/jquery.fancybox.min.js', myPrefix + '/css/jquery.fancybox.css'],
        _check_all      : myPrefix + '/js/vendor/check-all.min.js',
        _img_upload     : [myPrefix + '/js/vendor/fileinput.min.js', myPrefix + '/css/fileinput.css'],
    },

    init: function () {
        Site.fastClick();
        Site.enableActiveStateMobile();
        Site.WPViewportFix();
        Site.fixMainNav();
        Site.mainSlider();
        Site.detailZoom();
        Site.rating();
        Site.detailTabNav();
        Site.tabNav();
        Site.tabPay();
        Site.firstWord();
        Site.listSwitcher();
        Site.equalHeight();
        Site.faqIndex();
        //Site.mainHeight();
        Site.dropNav();
        Site.notifMessage();
        Site.login_nav();
        Site.dashboard_nav();
        Site.customSelect();
        Site.datepicker();
        Site.fancyBox();
        Site.uploadImg();
        Site.messageScroll();
        Site.checkAll();
        Site.submitBtn();
    },

    fastClick: function () {
        Modernizr.load({
            load    : Site.assets._fastclick,
            complete: function () {
                FastClick.attach(document.body);
            }
        });
    },

    enableActiveStateMobile: function () {
        if ( document.addEventListener ) {
            document.addEventListener('touchstart', function () {}, true);
        }
    },

    WPViewportFix: function () {
        if ( navigator.userAgent.match(/IEMobile\/10\.0/) ) {
            var style   = document.createElement("style"),
                fix     = document.createTextNode("@-ms-viewport{width:auto!important}");

            style.appendChild(fix);
            document.getElementsByTagName('head')[0].appendChild(style);
        }
    },

    fixMainNav: function () {
        var mywindow = $(window),
            main_nav = $('.site-header--main');
            main_site = $('.site-main');

        mywindow.scroll(function () {
            if (mywindow.scrollTop() > 30) {
                main_nav.addClass('fixed');
                main_site.addClass('fixed-main');
            }
            else {
                main_nav.removeClass('fixed');
                main_site.removeClass('fixed-main');
            }
        });

    },

    mainSlider: function () {
        var slider = $('#main-slider ul');

        if ( !slider.length ) return;

        slider.bxSlider({
            //controls: false
            auto: true,
            speed: 800,
            pause: 5500,
            nextText : '',
            prevText : ''
            //,pager : false
        });
    },

    detailZoom: function () {
        var $easyzoom = $('.easyzoom').easyZoom();

        if ( !$easyzoom.length ) return;
    },

    rating: function () {
        var rate_width = $('.rating-star').width(),
            rate_bar   = $('.rating-star-bar'),
            rate_total = $('.rating-count'),
            star_width = rate_width / 5;

        rate_bar.each(function(){
            var rate_parent = $(this).parent('.rating-star'),
                rate_count  = rate_parent.attr('data-rate');

            $(this).css('width', rate_count * star_width + 0.5);
        });

        rate_total.each(function(){
            var rate_count = $(this).parent().prev('.rating-star').attr('data-rate');

            $(this).text(rate_count);
        });
    },

    detailTabNav: function () {
        $('.img-nav a').on('click', function(e)  {
            var currentAttrValue = $(this).attr('href');

            // Show/Hide Tabs
            $('.product-info--img ' + currentAttrValue).fadeIn(300).siblings().fadeOut(100);

            // Change/remove current tab to active
            $(this).parent('li').addClass('active-nav').siblings().removeClass('active-nav');

            e.preventDefault();
        });
    },

    tabNav: function () {
        $('.tab-nav a').on('click', function(e)  {
            var currentAttrValue = $(this).attr('href');

            // Show/Hide Tabs
            $('.tab-section ' + currentAttrValue).fadeIn(50).siblings().fadeOut(20);
            $('.tab-inner ' + currentAttrValue).fadeIn(50).siblings().fadeOut(20);

            // Change/remove current tab to active
            $(this).parent('li').addClass('active-nav').siblings().removeClass('active-nav');

            e.preventDefault();
        });

    },

    tabPay: function () {
        $('.pay-nav a').on('click', function(e)  {
            var currentAttrValue    = $(this).attr('href'),
                inputRadio          = $(this).prev(':radio'),
                otherRadio          = $(this).parent().siblings().children(':radio');

            $('.tab-payment ' + currentAttrValue).show().siblings().hide();

            $(this).parent().addClass('active-nav').siblings().removeClass('active-nav');
            otherRadio.removeAttr('checked', 'checked');
            inputRadio.attr('checked', 'checked');

            e.preventDefault();
        });
    },

    firstWord: function () {
        $('.cover-category-overview h1').each(function(){     
            var $p = $(this);
            $p.html($p.html().replace(/^(\w+)/, '<span>$1</span>'));
        });
    },

    listSwitcher: function () {
        var list_view   = $('.view-list'),
            grid_view   = $('.view-grid'),
            layout      = $('.product-list');

            list_view.on('click', function(e)  {
                e.preventDefault();

                $(this).addClass('active-view').siblings().removeClass('active-view');
                layout.addClass('list-layout');
            });

            grid_view.on('click', function(e)  {
                e.preventDefault();
                $(this).addClass('active-view').siblings().removeClass('active-view');
                layout.removeClass('list-layout');
            });
    },

    equalHeight: function () {
        //$('.equal-height').css('height', $('.equal-height').parent().height());
    },

    faqIndex: function() {

        $('.item-number').each(function(){
            $(this).text( $(this).parent().index()+1);
        });
    },

    mainHeight: function() {
        $('.site-main').css('min-height', $(window).height() - 220);
    },

    dropNav: function () {
        $('.category-nav').hover(
           function(){ 
               $(this).addClass('active'); 
           },
           function(){ 
               $(this).removeClass('active'); 
           });
    },

    notifMessage: function () {
        $('.btn-close').on('click', function(e)  {
            e.preventDefault();

            $(this).parent().slideUp(1000);
        });
    },

    login_nav: function () {
        var trigger     = $('.btn-login'),
            formLogin   = $('.user-login');

        trigger.click(function(e) {
            e.preventDefault();
            e.stopPropagation();
            $(this).next(formLogin).toggleClass('active');
        });

        formLogin.click(function(e) {
            //e.preventDefault();
            e.stopPropagation();
        });
        
        $(document).click(function() {
            formLogin.removeClass('active');
        });
    },

    dashboard_nav: function () {
        var trigger         = $('.dashboard-nav-trigger'),
            dashboard_nav   = $('.dashboard-nav');

        trigger.click(function(e) {
            e.preventDefault();
            e.stopPropagation();
            $(this).next(dashboard_nav).toggleClass('active');
        });

        dashboard_nav.click(function(e) {
            //e.preventDefault();
            e.stopPropagation();
        });
        
        $(document).click(function() {
            dashboard_nav.removeClass('active');
        });
    },

    customSelect: function () {
        $('.chosen-select').chosen();
        $('button[type="reset"]').click(function(){
            //e.preventDefault();
            $('.chosen-select').val('').trigger('chosen:updated');
        });
    },

    datepicker: function () {
        var $elems = $('[data-datepicker]');

        if ( !$elems.length ) return;

        var initPlugin = function () {
            var options = {
                closeOnDateSelect: true,
                timepicker: false,
                scrollInput: false,
                format: 'Y-m-d',
                mask: true
            };

            $elems.datetimepicker(options);
        };

        Modernizr.load({
            load    : Site.assets._datepicker,
            complete: initPlugin
        });
    },

    fancyBox: function () {
        var $elems = $('.fancybox');

        if ( !$elems.length ) return;

        var initPlugin = function () {
            $elems.fancybox();

        };
        Modernizr.load({
            load    : Site.assets._fancyBox,
            complete: initPlugin
        });
    },

    submitBtn: function () {
        var checker = document.getElementById('agree-form'),
            sendbtn    = document.getElementById('btn-submit');
        // when unchecked or checked, run the function
        //if ( !checker.length ) return;

        checker.onchange = function(){
            if(this.checked){
                sendbtn.disabled = false;
            } else {
                sendbtn.disabled = true;
            }

        }
    },

    uploadImg: function () {
        var $elems = $('.custom-file');

        if ( !$elems.length ) return;

        var initPlugin = function () {
            $elems.fileinput();

        };
        Modernizr.load({
            load    : Site.assets._img_upload,
            complete: initPlugin
        });
    },

    checkAll: function () {

        $('#master-check').checkAll('.child-check:checkbox');

    },

    messageScroll: function (){

        var height = 0;
        $('.conversation-list li').each(function(i, value){
            height += parseInt($(this).height());
        });

        height += '';

        $('.conversation-list ul').animate({scrollTop: height});
    }

};

(function () {
    var siteInit = function () {
        Site.init();
    };

    var checkJquery = function () {
        if ( !window.jQuery ) {
            Modernizr.load([
                {
                    load    : Site.assets._jquery_local
                },
                {
                    load    : Site.assets._easyZoom
                },
                {
                    load    : Site.assets._chosen
                },
                {
                    load    : Site.assets._dropzone
                },
                {
                    load    : Site.assets._check_all
                },
                {
                    load    : Site.assets._bx_Slider,
                    complete: siteInit
                }
            ]);
        } else {
            Site.init();
        }
    };

    Modernizr.load([
        {
            load    : Site.assets._jquery_cdn
        },
        {
            load    : Site.assets._bxSlider,
            complete: checkJquery
        }
    ]);
})();
